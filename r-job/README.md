This folder explains how to prepare a DSRI project to run R scripts as jobs. As seen in https://maastrichtu-ids.github.io/dsri-documentation/docs/deploy-rstudio

To try it yourself, first clone the repository and go to this folder with your terminal:

```bash
git clone https://github.com/MaastrichtU-IDS/dsri-demo.git
cd dsri-demo/r-job
```

Make sure you are in the right project on the DSRI:

```bash
oc project $YOUR_PROJECT
```

## Prepare the volume

Create the volume (will be mounted on `/data` in the containers):

```bash
oc apply -f volume.yml
```

Start the Ubuntu container that will be used to copy the data generated by the jobs:

```bash
oc apply -f copy-container.yml
```

## Run the job

Build the docker image on the DSRI:

```bash
oc new-build --name r-job --binary
oc start-build r-job --from-dir=. --follow --wait
```

Start the job:

```bash
oc apply -f job.yml
```

Get the jobs logs:

```bash
oc logs job/r-job
```

Copy the files produced by the R script in `/data` on the DSRI to a `data` folder in your current local folder:

```bash
oc get pod --selector app=r-job --no-headers -o=custom-columns=NAME:.metadata.name | xargs -I {} oc cp {}:/data ./data
```

Delete the job (before re-running it):

```bash
oc delete -f job.yml
```

## Notes

Make sure the R script write the output to the persistent volume, in our case `/data` in the container.